pipeline {
   agent any

   stages {
      stage('download artifactory') {
         environment {
            JFROG_CREDENTIALS = credentials('jfrog-credentials')
         }
         steps {
            rtServer (
               id: 'jenkins-artifactory-id',
               url: 'http://localhost:8081/artifactory',
               username: env.JFROG_CREDENTIALS_USR,
               password: env.JFROG_CREDENTIALS_PSW
            )

            rtDownload (
               serverId: 'jenkins-artifactory-id',
               spec:
                  '''
                     {
                        "files":
                        [
                           {
                              "pattern": "gradle-release-local/springboot-rest/*.war",
                              "target": "springboot-rest.war"
                           }
                        ]
                     }
                  '''
            )
         }
      }

      stage('provisioning') {
         steps {
            sh '''
                  cd java/springboot-rest/infra
                  packer build -var-file=docker_credentials.json build.json
               '''
         }
      }
   }
}
